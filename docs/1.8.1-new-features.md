# 🚀 i18ntk 1.8.1 - New Features Documentation

## Overview

i18ntk 1.8.1 is a major feature release that introduces comprehensive framework detection, a powerful plugin system, enhanced security features, and significant performance improvements.

## 🎯 Framework Detection

### Automatic Framework Detection

i18ntk 1.8.1 now automatically detects popular i18n frameworks and applies appropriate validation rules:

- **i18next** - Detects via `i18next` dependency in package.json
- **Lingui** - Detects via `@lingui/core` dependency
- **FormatJS** - Detects via `react-intl` or `formatjs` dependencies

### Usage Examples

```bash
# Framework-aware analysis
i18ntk analyze --detect-framework

# Framework-specific validation
i18ntk validate --framework-aware

# Check detected frameworks
i18ntk doctor --framework-check
```

### Framework-Specific Rules

Each framework has tailored validation:
- **i18next**: Validates interpolation syntax, plural forms, context keys
- **Lingui**: Validates ICU message format, macro usage
- **FormatJS**: Validates ICU format, rich text formatting

## 🔌 Plugin System

### Architecture Overview

The new plugin system consists of:

- **PluginLoader** - Dynamically loads and manages plugins
- **FormatManager** - Handles different translation formats
- **Extractor Plugins** - Custom translation extractors
- **Validator Plugins** - Custom validation rules

### Creating Custom Plugins

#### Basic Plugin Structure

```javascript
// my-custom-plugin.js
module.exports = {
  name: 'my-custom-plugin',
  version: '1.0.0',
  
  extractors: {
    customExtractor: {
      extensions: ['.custom'],
      extract: (content, filePath) => {
        // Custom extraction logic
        return extractedKeys;
      }
    }
  },
  
  validators: {
    customValidator: {
      validate: (translation, context) => {
        // Custom validation logic
        return { valid: true, errors: [] };
      }
    }
  }
};
```

### Plugin Configuration

```json
{
  "plugins": {
    "enabled": ["my-custom-plugin"],
    "config": {
      "my-custom-plugin": {
        "option1": "value1"
      }
    }
  }
}
```

## 🔒 Security Enhancements

### Admin PIN Authentication

Enhanced admin authentication with command-line support:

```bash
# Interactive PIN entry
i18ntk manage --admin-auth

# Command-line PIN (for CI/CD)
i18ntk manage --admin-pin=123456 --no-prompt

# PIN configuration
i18ntk settings set admin-pin-enabled true
```

### Standardized Exit Codes

All CLI commands now use consistent exit codes:

| Exit Code | Description |
|-----------|-------------|
| 0 | Success |
| 1 | Configuration error |
| 2 | Validation failed |
| 3 | Security violation |
| 4 | Plugin error |
| 5 | Framework detection error |

### Enhanced Security Features

- **Path traversal prevention** - All file paths validated
- **Input sanitization** - Enhanced validation of all inputs
- **Session management** - Improved session handling
- **Audit logging** - Comprehensive security logging

## 📊 JSON Output Support

### Machine-Readable Results

```bash
# JSON output for CI/CD integration
i18ntk validate --format json > results.json

# Framework detection in JSON
i18ntk analyze --detect-framework --format json

# Plugin status in JSON
i18ntk doctor --format json
```

### JSON Schema

```json
{
  "version": "1.8.1",
  "timestamp": "2025-12-19T10:00:00Z",
  "framework": {
    "detected": "i18next",
    "version": "23.7.6"
  },
  "results": {
    "totalKeys": 1250,
    "missingKeys": 15,
    "unusedKeys": 8,
    "validationErrors": 3
  },
  "plugins": {
    "loaded": ["framework-detector", "validator-enhanced"],
    "errors": []
  }
}
```

## ⚡ Performance Improvements

### 87% Performance Boost

- **Ultra-Extreme Mode**: 15.38ms for 200k keys
- **Extreme Mode**: 38.90ms for 200k keys
- **Memory Usage**: <1MB for all operations
- **No Child Processes**: Removed all child_process usage

### Performance Tuning

```bash
# Ultra-extreme performance
i18ntk analyze --config=ultra-extreme

# Memory optimization
i18ntk validate --memory-optimized

# Batch processing
i18ntk complete --batch-size=1000
```

## 🏗️ Architecture Improvements

### Directory Structure

```
project/
├── src/
│   └── i18n/
│       └── locales/          # New recommended structure
├── i18ntk-config.json
└── package.json
```

### Config Directory Support

```bash
# Use standalone configuration directory
i18ntk --config-dir ./config/i18ntk

# Multiple configurations
i18ntk --config-dir ./configs/production
```

## 🧪 Testing Enhancements

### New Test Categories

- **Framework Detection Tests** - Validate framework detection
- **Security Feature Tests** - Test security implementations
- **Plugin System Tests** - Validate plugin loading and execution
- **Performance Benchmarks** - Continuous performance testing

### Test Commands

```bash
# Run framework detection tests
npm run test:framework-detection

# Run security tests
npm run test:security

# Run plugin tests
npm run test:plugins

# Full test suite
npm run test:full
```

## 🔄 Migration Guide

### From 1.8.0 to 1.8.1

1. **No breaking changes** - All existing commands work as before
2. **New features are optional** - Framework detection and plugins are opt-in
3. **Enhanced security** - Consider enabling admin PIN for sensitive operations
4. **Performance improvements** - Automatic with no configuration changes

### Configuration Migration

Existing configurations are fully compatible. To use new features:

```json
{
  "version": "1.8.1",
  "frameworkDetection": true,
  "plugins": {
    "enabled": ["framework-detector"]
  },
  "security": {
    "adminPinEnabled": true
  }
}
```

## 📚 API Reference

### Framework Detection API

```javascript
const { FrameworkDetector } = require('i18ntk/utils/framework-detector');

const detector = new FrameworkDetector();
const framework = await detector.detect('./project');
console.log(framework); // { name: 'i18next', version: '23.7.6' }
```

### Plugin API

```javascript
const { PluginLoader } = require('i18ntk/utils/plugin-loader');

const loader = new PluginLoader();
await loader.loadPlugin('my-custom-plugin');
```

## 🎯 Best Practices

### Security
- Use admin PIN for production environments
- Regularly update plugins
- Validate all inputs in custom plugins
- Use JSON output for CI/CD integration

### Performance
- Use ultra-extreme mode for large datasets
- Enable caching for repeated operations
- Use batch processing for bulk operations
- Monitor memory usage with performance mode

### Framework Detection
- Let i18ntk auto-detect frameworks when possible
- Use framework-specific validation rules
- Test detection in CI/CD pipelines
- Document framework choices for team consistency